\section{Discussion}\label{sec:discussion}

In Section~\ref{sec:attack}, we discussed how unauthenticated commands can be made to the Starlink user terminal to disable it.
These commands can, as discussed in Section~\ref{sec:impact}, be issued by an attacker present on the local network, or instead by a remote attacker.
Therefore, these security issues are similar to those faced by other commercial routers and server software, where bootstrapping a secure connection in the first instance is non-trivial.

We therefore seek to outline the challenges and mitigations faced by the Starlink dish, and outline more general principles on secure router design.

\subsection{Challenges}

Some of the challenges facing secure router administration are as follows:

\subsubsection{Drive-by browser exploitation}

The administrative interface served at ``\url{my.starlink.com}'' makes cross-origin connections to \texttt{192.168.100.1} to configure the network.
Modern browsers restrict these requests according to the Cross-Origin Resource Sharing (CORS) policy.
These restrictions are primarily designed to disallow websites reading data from other websites' servers, unless that server opts in using the \texttt{Access-Control-Allow-Origin} header.
In the case of Starlink, the server at \texttt{192.168.100.1} reports that only connections from ``\url{my.starlink.com}'' are allowed.
As a result, browsers that enforce the CORS policy will refuse to allow websites other than \url{my.starlink.com}'' to read the responses of requests that are made.

However, in the case of the Starlink dish and several other routers~\textbf{TODO: cite}, changing the configuration doesn't require reading the response, only making the requests in the first place.
To secure this case, non-simple requests now trigger a CORS preflight request~\cite{simple_requests, preflight_request} to confirm the \texttt{Access-Control-Allow-Origin} before sending the initial request.

In certain routers, only simple requests are required to change the state~\textbf{TODO: cite}, and are therefore vulnerable to drive-by browser exploitation even on modern browsers.
However, the POST request required for the Starlink dish is non-simple since it requires the \texttt{content-type: application/grpc-web+proto} header.
As a result, the Starlink dish is only exploitable using this method with older, insecure browsers~\textbf{TODO: cite which browsers are vulnerable}.

\subsubsection{Local attacking}

DNS hijacking, etc.

\subsection{Mitigations}

\subsubsection{Password authentication}

One of the key challenges to the security of the Starlink system is the unauthenticated nature of the commands.
Therefore, sending HTTP requests to the router is sufficient to perform the attack, without the attacker requiring any prior information such as a password.
However, implementing a password authentication system is non-trivial, and adds inconvenience to the user each time they need to use the interface.

One of the key challenges is that, since the Starlink modem does not use TLS to secure the connection, any password would be sent in plain text and therefore be sniffable to adversaries on the network.
However, password authentication by itself would prevent simple drive-by browser exploitation; a malicious website attempting to make a cross-origin request to the modem would not necessarily know the password, and therefore be unable to make the request.
This mechanism is used by multiple consumer routers~\textbf{TODO: cite} to prevent this attack.

\subsubsection{Trust On First Use}

An additional challenge with password authentication is securely establishing a password in the first instance.
Some commercial routers use default passwords, but don't design the UI to encourage users to change them.
As a result, password protected routers that remain on their default passwords can be vulnerable to drive-by browser exploitation.

One method for resolving this is UI design to force the user to change the default password on first use.
Along a similar vein, the Starlink default SSID is ``Stinky" to force the user to change it~\cite{stinky_starlink}.
Another similar method is implementing a Trust On First Use (TOFU) policy, in which there is no default password set, but the user is forced to change it.
This approach is used successfully in applications such as SSH.

\subsubsection{The use of TLS}

As aforementioned, even the use of password authentication is insufficient to prevent attackers on the local network from sniffing and reusing the password.
This same problem of packet sniffing is addressed on the public internet through TLS certificates.
An encrypted connection is opened between the browser and web server where a third party vouches for the authenticity of the server, preventing man-in-the-middle interception.

On the surface it appears that implementing TLS in this context should be easy; certificates can be created automatically, from widely-accepted root certificate authorities, even for private network services, using tools like Let's Encrypt.
Certain engineering issues would need to be overcome, such as implementing TLS across the entire modem, to allow connections from browsers which block insecure cross-origin requests from secure domains.
However, there are also a number of fundamental issues in implementing TLS in this context.

The simplest approach, which is used by certain ISPs such as FRITZ!Box, involves creating a unique certificate for each router~\cite{fritzbox_cert}.
Since TLS certificates can only be issued for domain names, and not for IP addresses, each certificate is assigned to the same address.
The router then responds itself to requests at that domain, using its certificate.

Issues therefore arise when initiating the connection.
If the certificate is signed by a root certificate authority, then any certificate from any router is equally valid.
Attackers can therefore circumvent the signed check by extracting the certificate from different hardware.

If instead the certificate is self-signed, users can download the certificate and load it into their browser to verify future connections.
However, it is then impossible to secure the transfer of the certificate, during which the attacker can insert their own certificate.

Even if implementing TLS with perfect security guarantees is not possible, the self-signed approach appears to be the most secure.
This is because successful attackers must maintain presence and intercept the connection when the TLS certificate is downloaded in order to execute any future attack.

\subsection{Guest mode}

Another approach is limiting access to the admin interface to a separate network or separate network interface.
Currently, the Starlink modem partially implements this through guest network mode.
Users connected to this guest network can't access the admin interface, protecting the terminal from reconfiguration by any device connected on the network.

The terminal could be made slightly more secure by either disconnecting the administrative interface from the public internet, disabling any form of drive-by attack.
Users would be encouraged to use only the guest network for any kind of network access.

\begin{comment}
  Edd's notes:

Related work:

Zoom exploit, hitting services running on the local network

https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy
"Cross-origin writes are typically allowed"

https://bugzilla.mozilla.org/show_bug.cgi?id=629094
https://www.grepular.com/Abusing_HTTP_Status_Codes_to_Expose_Private_Information
HTTP status code abuse to extract information cross-origin

https://bugzilla.mozilla.org/show_bug.cgi?id=354493
Zoom videoconferencing problem

https://bugzilla.mozilla.org/show_bug.cgi?id=371598
Drive-by pharming through browsers


Security constraints:

Defeating drive-by javascript:
unencrypted passwords prevents silent drive-by javascript, potentially
websites can still brute force or phish the password from you
some sort of CSRF token from my.starlink.com?

Defeating spoofing my.starlink.com:
Vulnerable: because it's using plaintext http
Reason: you can't make a request to an insecure origin from a secure origin (need citation)
use https
passwords prevent silently changing the dish

Attackers on local network:

HSTS could be used with TLS to secure this
CSRF tokens

%Additionally, certificates have not been issued to secure the traffic to the user terminal, meaning they are conducted in plain http.
%%\texttt{my.starlink.com} is therefore also served in plain http, since browsers do not permit resource sharing from a secure origin (https) to an insecure origin (http).
%%Although Starlink can prevent man-in-the-middle attacks by ensuring that \texttt{my.starlink.com} is only served through their encrypted satellite data link, this still opens the door for other attacks such as DNS hijacking and IP spoofing.
%


\end{comment}
