\section{Discussion}\label{sec:discussion}

In Section~\ref{sec:attack}, we discussed how unauthenticated commands can be made to the Starlink user terminal to disable it.
These commands can, as discussed in Section~\ref{sec:impact}, be issued by an attacker present on the local network, or remotely if a user can be tricked into running a malicious executable.
Therefore, these security issues are similar to those faced by other commercial routers and server software, where bootstrapping a secure connection in the first instance is non-trivial.

We therefore seek to outline the challenges and mitigations faced by the Starlink dish, and outline more general principles on secure router design.

\subsection{Challenges}

Some of the challenges facing secure router administration are as follows:

\subsubsection{Drive-by browser exploitation}

The administrative interface served at ``\url{http://my.starlink.com}'' makes cross-origin connections to the local router at \texttt{192.168.100.1} to configure the network.
Modern browsers restrict these requests according to the Cross-Origin Resource Sharing (CORS) policy.
These restrictions are primarily designed to disallow websites reading data from other websites' servers, unless that server opts in using the \texttt{Access-Control-Allow-Origin} header.
In the case of Starlink, the server at \texttt{192.168.100.1} reports that only connections from ``\url{http://my.starlink.com}'' are allowed.
As a result, browsers that enforce the CORS policy will refuse to allow websites other than ``\url{http://my.starlink.com}'' to read the responses of requests that are made.

However, in the case of the Starlink dish and several other routers, changing the configuration doesn't require reading the response, only making the requests in the first place~\cite{drive_by_pharming}.
To secure this case, non-simple requests now trigger a CORS preflight request to confirm the \texttt{Access-Control-Allow-Origin} before sending the initial request~\cite{simple_requests, preflight_request}.

In certain routers, only simple requests are required to change the state, and are therefore vulnerable to drive-by browser exploitation even on modern browsers~\cite{csrf_internal_network}.
However, the POST request used to configure the Starlink dish requires the \texttt{content-type: application/grpc-web+proto} header, making it non-simple.
As a result, the Starlink dish is only exploitable using this method on older browsers which do not use the preflight check~\cite{cors_w3c}.

\subsubsection{Local network attack}

Additionally, since administrative commands can be sent from any device on the local network, any attacker capable of maintaining persistence on the local network can send commands.
As we go on to discuss below, password authentication is sufficient to significantly increase the difficulty of executing the attack.
However, by more subtly acting on the local network, the attacker can still affect the security of the system.

One method is through DNS hijacking, in which the attacker responds to DNS requests on the local network to redirect the ``\url{http://my.starlink.com}'' domain to their own server.
This is possible, even if TLS were used, since the browser does not expect a secure connection; we argue this can be resolved through the use of HTTP Strict Transport Security~\cite{rfc6797}.

Another method is IP spoofing, in which the attacker responds to an HTTP request to ``\url{http://my.starlink.com}'' with a maliciously formed website in order to make the request to the router.

\subsection{Mitigations}

Although the attack explored in this paper only directly applies to the Starlink user terminal, we can derive wider lessons on the secure design of satellite routers.
We proceed to explore some of these mitigations and the challenges surrounding their implementation.

\subsubsection{Password authentication}\label{sec:password_authentication}

Password authenticating administrative commands is critical in order to maintain security of the network.
This is particularly true for satellite modems, where physical hardware is controlled by the modem.
A secure password should be set by default for administrative operations, which must be randomized per router to prevent reuse by the adversary across multiple networks.
Manufacturers should also be aware that unencrypted connections to the router over an unsecured network exposes the password to sniffing on the local network.

This is a problem for Starlink routers, which do not password protect the WiFi network by default -- this is considered bad practice, and the vast majority of router manufacturers set a password by default.
The admin panel is therefore left open to the attacker by default since it is neither encrypted nor password protected.
The particular challenges surrounding the implementation of encrypted admin interfaces are discussed below.

\subsubsection{Transport Layer Security}

Encrypting the admin interface requires a TLS certificate on the router, which can be verified by the user's browser.
Further security concerns are raised if these certificates are signed by a root authority, since attackers can extract the certificate from one router and use it on another.

Routers should therefore generate self-signed certificates that can be downloaded by the user and installed into their browser.
Some routers such as AVM's FRITZ!Box implement this, creating a unique certificate for each router~\cite{fritzbox_cert}.
Manufacturers implementing this should be aware of the risks of sending the certificate over an initially insecure connection.

\subsubsection{Trust On First Use}

\textbf{TODO: Refactor these in light of structure above}
One challenge with password authentication is securely establishing a password in the first instance.
Some routers use default passwords, but don't design the UX to encourage users to change them -- this can expose the router to drive-by exploitation.
Most commercial routers set a random default password, or implement a Trust On First Use (TOFU) policy, in which there is a default password, but it must be changed after its first use.

The Starlink routers attempt to incentivize the user to change the router SSID by setting it by default to ``Stinky''~\cite{stinky_starlink} -- however, no policy is implemented to encourage secure passwords.

\subsubsection{Guest mode}

If an unencrypted network is required, then access to the admin interface must be limited.
The Starlink modem implements this through a ``guest mode'', providing a network which does not have access to the admin interface.
This protects the terminal from reconfiguration by untrusted users.

The terminal could be made slightly more secure by disconnecting the administrative interface from the public internet, disabling any form of drive-by attack.

\begin{comment}
  Edd's notes:

Related work:

Zoom exploit, hitting services running on the local network

https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy
"Cross-origin writes are typically allowed"

https://bugzilla.mozilla.org/show_bug.cgi?id=629094
https://www.grepular.com/Abusing_HTTP_Status_Codes_to_Expose_Private_Information
HTTP status code abuse to extract information cross-origin

https://bugzilla.mozilla.org/show_bug.cgi?id=354493
Zoom videoconferencing problem

https://bugzilla.mozilla.org/show_bug.cgi?id=371598
Drive-by pharming through browsers


Security constraints:

Defeating drive-by javascript:
unencrypted passwords prevents silent drive-by javascript, potentially
websites can still brute force or phish the password from you
some sort of CSRF token from http://my.starlink.com?

Defeating spoofing http://my.starlink.com:
Vulnerable: because it's using plaintext http
Reason: you can't make a request to an insecure origin from a secure origin (need citation)
use https
passwords prevent silently changing the dish

Attackers on local network:

HSTS could be used with TLS to secure this
CSRF tokens

%Additionally, certificates have not been issued to secure the traffic to the user terminal, meaning they are conducted in plain http.
%%\texttt{http://my.starlink.com} is therefore also served in plain http, since browsers do not permit resource sharing from a secure origin (https) to an insecure origin (http).
%%Although Starlink can prevent man-in-the-middle attacks by ensuring that \texttt{http://my.starlink.com} is only served through their encrypted satellite data link, this still opens the door for other attacks such as DNS hijacking and IP spoofing.
%


\end{comment}
